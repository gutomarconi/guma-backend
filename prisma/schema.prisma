generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())
  users     User[]
  apiKeys   ApiKey[]
}

model User {
  id        Int      @id @default(autoincrement())
  companyId Int?
  name      String   @default("")
  email     String   @unique
  senha     String
  role      String   @default("user")
  createdAt DateTime @default(now())
  company   Company? @relation(fields: [companyId], references: [id])
}

model ApiKey {
  id          Int      @id @default(autoincrement())
  companyId   Int
  key         String   @unique
  description String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  company     Company  @relation(fields: [companyId], references: [id])
}

model PO {
  id          Int       @id @default(autoincrement())
  companyId   Int
  description String
  createdAt   DateTime  @default(now())
  Machine     Machine[]
}

enum CapacityUnity {
  M2
  UN
}

model Machine {
  id             Int           @id @default(autoincrement())
  companyId      Int
  description    String
  createdAt      DateTime      @default(now())
  poId           Int
  capacity       Float
  capacity_unity CapacityUnity @default(M2)
  unity_cost     Float
  po             PO            @relation(fields: [poId], references: [id])
}

model Item {
  id                  Int           @id @default(autoincrement())
  companyId           Int
  order_number        Int
  batch_number        Int
  box_number          Int?
  barcode             String
  order_date          DateTime
  rawData             Json
  createdAt           DateTime      @default(now())
  itemHistory         ItemHistory[]
  item_code           String
  buy_order           String
  order_delivery_date DateTime
  load_number         String
  has_cutting_po      Boolean
  has_bordering_po    Boolean
  has_drilling_po     Boolean
  has_packaging_po    Boolean
  description         String
  quantity            Float
  cubic_meter         Float      @default(0)
  linear_meter        Float      @default(0)
  square_meter        Float      @default(0)
  material_cut        String      @default("")
  material_border     String      @default("")
}

model ItemHistory {
  id        Int  @id @default(autoincrement())
  companyId Int
  itemId    Int
  item      Item @relation(fields: [itemId], references: [id])
  machineId Int
  createdAt DateTime      @default(now())
  readDate  DateTime      @default(now())
}

model FileMapping {
  id          Int  @id @default(autoincrement())
  companyId   Int
  mapping     Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model MachineFingerprint {
  id          Int  @id @default(autoincrement())
  companyId   Int
  fingerprint String
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  machineId   Int
}